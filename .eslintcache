[{"/home/mintian/pku/vis/paper_management_system/src/Views/UnitView/index.js":"1","/home/mintian/pku/vis/paper_management_system/src/Views/UnitView/CircleUnit.js":"2","/home/mintian/pku/vis/paper_management_system/src/Store/createStore.js":"3","/home/mintian/pku/vis/paper_management_system/src/App.js":"4","/home/mintian/pku/vis/paper_management_system/src/Views/ControlView/index.js":"5","/home/mintian/pku/vis/paper_management_system/src/reportWebVitals.js":"6","/home/mintian/pku/vis/paper_management_system/src/Views/Header/index.js":"7","/home/mintian/pku/vis/paper_management_system/src/Common/userList.js":"8","/home/mintian/pku/vis/paper_management_system/src/index.js":"9","/home/mintian/pku/vis/paper_management_system/src/Views/DetailView/index.js":"10"},{"size":7579,"mtime":1611568971190,"results":"11","hashOfConfig":"12"},{"size":1859,"mtime":1611569462270,"results":"13","hashOfConfig":"12"},{"size":7356,"mtime":1611583764900,"results":"14","hashOfConfig":"12"},{"size":1263,"mtime":1611569375890,"results":"15","hashOfConfig":"12"},{"size":1879,"mtime":1611569387700,"results":"16","hashOfConfig":"12"},{"size":362,"mtime":1611393161130,"results":"17","hashOfConfig":"12"},{"size":884,"mtime":1611499021930,"results":"18","hashOfConfig":"12"},{"size":420,"mtime":1611498306680,"results":"19","hashOfConfig":"12"},{"size":529,"mtime":1611497147020,"results":"20","hashOfConfig":"12"},{"size":5808,"mtime":1611585434730,"results":"21","hashOfConfig":"12"},{"filePath":"22","messages":"23","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"24"},"1bkbmzn",{"filePath":"25","messages":"26","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"27","messages":"28","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"31","messages":"32","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"37","messages":"38","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"39","messages":"40","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"41","messages":"42","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},"/home/mintian/pku/vis/paper_management_system/src/Views/UnitView/index.js",["43","44","45","46"],"import React, { useEffect, useState } from \"react\";\nimport \"./index.scss\";\nimport CircleUnit from \"./CircleUnit\";\nimport { useGlobalStore } from \"../../Store\";\nimport { observer } from \"mobx-react-lite\";\nimport { toJS } from \"mobx\";\nimport { get } from \"lodash\";\nimport * as d3 from \"d3\";\n\nconst UnitView = observer(() => {\n  const store = useGlobalStore();\n  const {\n    papers,\n    unitXAttr,\n    unitYAttr,\n    unitXAttrList,\n    unitYAttrList,\n    unitBlockCount,\n    maxUnitBlockPaperCount,\n    doi2paperBlockPos,\n    doi2privateTags,\n    doi2publicTags,\n    doi2comments,\n    doi2colors,\n    controlIsActive,\n    currentSelected,\n    setCurrentSelected,\n  } = store;\n\n  // console.log(\"doi2colors\", toJS(doi2colors));\n\n  // const svg = document.querySelector(\"#unit-svg\");\n  // const svgWidth =\n  //   svg.clientWidth - unitLayoutPadding.left - unitLayoutPadding.right;\n  // const svgHeight =\n  //   svg.clientHeight - unitLayoutPadding.top - unitLayoutPadding.bottom;\n\n  const [svgWidth, setSvgWidth] = useState(0);\n  const [svgHeight, setSvgHeight] = useState(0);\n\n  // 初始化svg长宽\n  useEffect(() => {\n    const svg = document.querySelector(\"#unit-svg\");\n    setSvgWidth(\n      svg.clientWidth - unitLayoutPadding.left - unitLayoutPadding.right\n    );\n    setSvgHeight(\n      svg.clientHeight - unitLayoutPadding.top - unitLayoutPadding.bottom\n    );\n  }, []);\n  const unitLayoutPadding = {\n    top: svgWidth * 0.02,\n    left: 40,\n    right: 15,\n    bottom: 1,\n  };\n\n  const unitBlockPadding = {\n    top: 2,\n    left: 3,\n    right: 3,\n    bottom: 1,\n  };\n  const unitBlockWidth =\n    unitXAttrList.length > 0\n      ? svgWidth / unitXAttrList.length -\n        unitBlockPadding.left -\n        unitBlockPadding.right\n      : 0;\n  const unitBlockHeight =\n    unitYAttrList.length > 0\n      ? svgHeight / unitYAttrList.length -\n        unitBlockPadding.top -\n        unitBlockPadding.bottom\n      : 0;\n  // console.log(unitBlockWidth, unitBlockHeight);\n\n  const aspectRatio = Math.floor(\n    unitBlockWidth > 0 ? unitBlockHeight / unitBlockWidth : 1\n  );\n\n  const blockCountX = Math.ceil(\n    Math.sqrt(maxUnitBlockPaperCount / aspectRatio)\n  );\n  // console.log('blockCountX', blockCountX);\n\n  const xAttr2blockCountX = unitXAttrList.map((xAttr, i) => {\n    const maxColumnBlockCount = Math.max(\n      ...unitYAttrList.map((yAttr, j) => get(unitBlockCount, [xAttr, yAttr], 0))\n    );\n    let blockCountX = Math.ceil(\n      Math.sqrt(maxUnitBlockPaperCount / aspectRatio)\n    );\n    if (maxColumnBlockCount > maxUnitBlockPaperCount) {\n      blockCountX += 1;\n    }\n    return blockCountX;\n  });\n  // console.log(\"xAttr2blockCountX\", xAttr2blockCountX);\n\n  // const blockCountY = Math.ceil(aspectRatio * blockCountX);\n\n  let r = unitBlockWidth / blockCountX;\n  // console.log(\"r\", r);\n\n  const xAttr2blockCountX_StartCount = [0];\n  const xAttr2blockCountX_StartPos = [0];\n\n  for (let i = 1; i < unitXAttrList.length; i++) {\n    xAttr2blockCountX_StartCount.push(\n      xAttr2blockCountX_StartCount[i - 1] + xAttr2blockCountX[i - 1]\n    );\n  }\n\n  r =\n    (svgWidth -\n      (unitBlockPadding.left + unitBlockPadding.right) * unitXAttrList.length) /\n    (xAttr2blockCountX_StartCount[xAttr2blockCountX_StartCount.length - 1] +\n      xAttr2blockCountX[xAttr2blockCountX.length - 1]);\n  // console.log(\"new r\", r);\n\n  for (let i = 1; i < unitXAttrList.length; i++) {\n    xAttr2blockCountX_StartPos.push(\n      xAttr2blockCountX_StartCount[i] * r +\n        (unitBlockPadding.left + unitBlockPadding.right) * i\n    );\n  }\n  // console.log(\"xAttr2blockCountX_StartCount\", xAttr2blockCountX_StartCount);\n  // console.log(\"xAttr2blockCountX_StartPos\", xAttr2blockCountX_StartPos);\n  const scale = d3.scaleLinear().domain([0, 100]).range([0.25, 0.8]);\n  const citeCount2grey = (count) => d3.interpolateGreys(scale(count));\n  const paperCircles = papers.map((paper) => {\n    const paperCircle = {};\n    paperCircle.oriData = toJS(paper);\n\n    paperCircle.BlockIndexX = unitXAttrList.indexOf(paper[unitXAttr]);\n    paperCircle.BlockIndexY = unitYAttrList.indexOf(paper[unitYAttr]);\n\n    const doi = paper.DOI;\n    paperCircle.doi = doi;\n\n    paperCircle.circleIndexX =\n      doi2paperBlockPos[doi] % xAttr2blockCountX[paperCircle.BlockIndexX];\n    paperCircle.circleIndexY = Math.floor(\n      doi2paperBlockPos[doi] / xAttr2blockCountX[paperCircle.BlockIndexX]\n    );\n\n    paperCircle.cx =\n      unitLayoutPadding.left +\n      paperCircle.BlockIndexX *\n        (unitBlockWidth + unitBlockPadding.left + unitBlockPadding.right) +\n      (paperCircle.circleIndexX + 0.5) * r;\n    paperCircle.cy =\n      unitLayoutPadding.top +\n      paperCircle.BlockIndexY *\n        (unitBlockHeight + unitBlockPadding.top + unitBlockPadding.bottom) +\n      (paperCircle.circleIndexY + 0.5) * r;\n\n    paperCircle.cx =\n      unitLayoutPadding.left +\n      xAttr2blockCountX_StartPos[paperCircle.BlockIndexX] +\n      (paperCircle.circleIndexX + 0.5) * r;\n\n    paperCircle.citationGrey = citeCount2grey(paper.CitationCount);\n    paperCircle.activeColors = get(doi2colors, doi, []);\n    paperCircle.colors =\n      paperCircle.activeColors.length > 0\n        ? paperCircle.activeColors\n        : [paperCircle.citationGrey];\n\n    paperCircle.opacity = controlIsActive\n      ? paperCircle.activeColors.length > 0\n        ? 0.8\n        : 0.4\n      : 0.8;\n\n    paperCircle.title = paper.Title;\n\n    return paperCircle;\n  });\n\n  const xLabels = unitXAttrList.map((xAttr, i) => {\n    const startX = unitLayoutPadding.left + xAttr2blockCountX_StartPos[i];\n    const middleX = startX + (xAttr2blockCountX[i] * r) / 2;\n    return {\n      value: xAttr,\n      x: middleX,\n      y: unitLayoutPadding.top * 0.8,\n    };\n  });\n\n  const yLabels = unitYAttrList.map((yAttr, i) => {\n    const startY =\n      unitLayoutPadding.top +\n      (unitBlockHeight + unitBlockPadding.top + unitBlockPadding.bottom) * i;\n    return {\n      value: yAttr,\n      x: unitLayoutPadding.left * 0.35,\n      y: startY,\n    };\n  });\n\n  const handleClickPaper = (doi) => {\n    console.log(\"click\", doi);\n    setCurrentSelected(doi);\n  };\n\n  return (\n    <div className=\"unit-view\">\n      <svg id=\"unit-svg\" width=\"100%\" height=\"100%\">\n        <g id=\"units\">\n          {paperCircles.map((paper, i) => (\n            <CircleUnit\n              key={i}\n              cx={paper.cx}\n              cy={paper.cy}\n              r={r / 2.4}\n              // grey={paper.citationGrey}\n              // oriData={paper.oriData}\n              doi={paper.doi}\n              colors={paper.colors}\n              opacity={paper.opacity}\n              handleClick={handleClickPaper}\n              isSelect={currentSelected === paper.doi}\n              title={paper.title}\n            />\n          ))}\n        </g>\n        <g id=\"x-label\">\n          {xLabels.map((label) => (\n            <text\n              key={label.value}\n              x={label.x}\n              y={label.y}\n              textAnchor=\"middle\"\n              fontSize={r * 1.6}\n              fill=\"rgb(78, 78, 78)\"\n            >\n              {label.value}\n            </text>\n          ))}\n        </g>\n        <g id=\"y-label\">\n          {yLabels.map((label) => (\n            <text\n              key={label.value}\n              // x={label.x}\n              // y={label.y}\n              // textAnchor=\"start\"\n              transform={`translate(${label.x}, ${label.y}) rotate(90)`}\n              fontSize={r * 1.6}\n              fill=\"rgb(78, 78, 78)\"\n            >\n              {label.value}\n            </text>\n          ))}\n        </g>\n      </svg>\n    </div>\n  );\n});\n\nexport default UnitView;\n","/home/mintian/pku/vis/paper_management_system/src/Views/UnitView/CircleUnit.js",[],"/home/mintian/pku/vis/paper_management_system/src/Store/createStore.js",["47"],"/home/mintian/pku/vis/paper_management_system/src/App.js",[],"/home/mintian/pku/vis/paper_management_system/src/Views/ControlView/index.js",["48","49"],"/home/mintian/pku/vis/paper_management_system/src/reportWebVitals.js",[],"/home/mintian/pku/vis/paper_management_system/src/Views/Header/index.js",[],"/home/mintian/pku/vis/paper_management_system/src/Common/userList.js",[],"/home/mintian/pku/vis/paper_management_system/src/index.js",[],"/home/mintian/pku/vis/paper_management_system/src/Views/DetailView/index.js",["50","51","52"],{"ruleId":"53","severity":1,"message":"54","line":21,"column":5,"nodeType":"55","messageId":"56","endLine":21,"endColumn":20},{"ruleId":"53","severity":1,"message":"57","line":22,"column":5,"nodeType":"55","messageId":"56","endLine":22,"endColumn":19},{"ruleId":"53","severity":1,"message":"58","line":23,"column":5,"nodeType":"55","messageId":"56","endLine":23,"endColumn":17},{"ruleId":"59","severity":1,"message":"60","line":50,"column":6,"nodeType":"61","endLine":50,"endColumn":8,"suggestions":"62"},{"ruleId":"53","severity":1,"message":"63","line":2,"column":10,"nodeType":"55","messageId":"56","endLine":2,"endColumn":14},{"ruleId":"53","severity":1,"message":"64","line":1,"column":27,"nodeType":"55","messageId":"56","endLine":1,"endColumn":36},{"ruleId":"53","severity":1,"message":"63","line":5,"column":10,"nodeType":"55","messageId":"56","endLine":5,"endColumn":14},{"ruleId":"53","severity":1,"message":"65","line":8,"column":22,"nodeType":"55","messageId":"56","endLine":8,"endColumn":29},{"ruleId":"53","severity":1,"message":"66","line":93,"column":10,"nodeType":"55","messageId":"56","endLine":93,"endColumn":19},{"ruleId":"67","severity":1,"message":"68","line":117,"column":38,"nodeType":"69","messageId":"70","endLine":117,"endColumn":40},"no-unused-vars","'doi2privateTags' is assigned a value but never used.","Identifier","unusedVar","'doi2publicTags' is assigned a value but never used.","'doi2comments' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'unitLayoutPadding.bottom', 'unitLayoutPadding.left', 'unitLayoutPadding.right', and 'unitLayoutPadding.top'. Either include them or remove the dependency array.","ArrayExpression",["71"],"'toJS' is defined but never used.","'useEffect' is defined but never used.","'Tooltip' is defined but never used.","'editInput' is assigned a value but never used.","eqeqeq","Expected '!==' and instead saw '!='.","BinaryExpression","unexpected",{"desc":"72","fix":"73"},"Update the dependencies array to be: [unitLayoutPadding.bottom, unitLayoutPadding.left, unitLayoutPadding.right, unitLayoutPadding.top]",{"range":"74","text":"75"},[1361,1363],"[unitLayoutPadding.bottom, unitLayoutPadding.left, unitLayoutPadding.right, unitLayoutPadding.top]"]